<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é€šç”¨ HTML éƒ¨ç½²é¢„è§ˆå™¨</title>
    <style>
        :root { --sidebar-width: 260px; --primary: #2563eb; --border: #e2e8f0; }
        body { font-family: system-ui, -apple-system, sans-serif; margin: 0; display: flex; height: 100vh; background: #f8fafc; color: #1e293b; }

        /* ä¾§è¾¹æ æ ·å¼ */
        #sidebar { 
            width: var(--sidebar-width); background: white; border-right: 1px solid var(--border);
            display: flex; flex-direction: column; flex-shrink: 0; box-shadow: 2px 0 5px rgba(0,0,0,0.02);
        }
        .sidebar-header { padding: 24px 16px; border-bottom: 1px solid var(--border); }
        .upload-btns { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
        .btn-label { 
            background: var(--primary); color: white; padding: 10px; border-radius: 6px; 
            cursor: pointer; font-size: 13px; text-align: center; font-weight: 500; transition: opacity 0.2s;
        }
        .btn-label.secondary { background: #64748b; }
        .btn-label:hover { opacity: 0.9; }

        #file-list { flex-grow: 1; overflow-y: auto; list-style: none; padding: 12px; margin: 0; }
        #file-list li { 
            padding: 10px 12px; margin-bottom: 4px; border-radius: 6px; cursor: pointer;
            font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            color: #475569; border: 1px solid transparent;
        }
        #file-list li:hover { background: #f1f5f9; border-color: var(--border); }
        #file-list li.active { background: #eff6ff; color: var(--primary); font-weight: 600; border-color: #bfdbfe; }

        /* ä¸»é¢„è§ˆåŒº */
        #main { flex-grow: 1; display: flex; flex-direction: column; background: #fff; }
        .top-bar { height: 50px; display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid var(--border); font-size: 13px; color: #94a3b8; }
        #preview-frame { width: 100%; flex-grow: 1; border: none; }
        
        .placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #cbd5e1; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <aside id="sidebar">
        <div class="sidebar-header">
            <strong style="font-size: 18px; color: #0f172a;">éƒ¨ç½²é¢„è§ˆ</strong>
            <div class="upload-btns">
                <label class="btn-label">
                    ğŸ“„ ä¸Šä¼ å•ä¸ª HTML
                    <input type="file" id="file-input" accept=".html" hidden>
                </label>
                <label class="btn-label secondary">
                    ğŸ“‚ ä¸Šä¼ é¡¹ç›®æ–‡ä»¶å¤¹
                    <input type="file" id="folder-input" webkitdirectory directory multiple hidden>
                </label>
            </div>
        </div>
        <ul id="file-list">
            <div class="placeholder" style="font-size: 12px;">ç­‰å¾…ä¸Šä¼ èµ„æº...</div>
        </ul>
    </aside>

    <main id="main">
        <div class="top-bar" id="status-bar">å°±ç»ª</div>
        <div id="content-area" style="flex-grow: 1; position: relative;">
            <div id="welcome" class="placeholder">
                <p>è¯·é€šè¿‡å·¦ä¾§ä¸Šä¼  HTML æ–‡ä»¶æˆ–å‰ç«¯é¡¹ç›®æ–‡ä»¶å¤¹</p>
            </div>
            <iframe id="preview-frame" class="hidden"></iframe>
        </div>
    </main>

<script>
    const fileInput = document.getElementById('file-input');
    const folderInput = document.getElementById('folder-input');
    const fileListElement = document.getElementById('file-list');
    const previewFrame = document.getElementById('preview-frame');
    const welcome = document.getElementById('welcome');
    const statusBar = document.getElementById('status-bar');

    let fileMap = {}; 

    // ç›‘å¬å•ä¸ªæ–‡ä»¶ä¸Šä¼ 
    fileInput.addEventListener('change', (e) => handleFiles(Array.from(e.target.files), false));
    // ç›‘å¬æ–‡ä»¶å¤¹ä¸Šä¼ 
    folderInput.addEventListener('change', (e) => handleFiles(Array.from(e.target.files), true));

    async function handleFiles(files, isFolder) {
        if (files.length === 0) return;

        fileMap = {};
        fileListElement.innerHTML = ''; 
        let htmlFiles = [];

        for (const file of files) {
            // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œä¿ç•™ç›¸å¯¹è·¯å¾„ï¼›å¦‚æœæ˜¯å•æ–‡ä»¶ï¼Œç›´æ¥å–æ–‡ä»¶å
            const path = isFolder ? file.webkitRelativePath.split('/').slice(1).join('/') : file.name;
            const blobUrl = URL.createObjectURL(file);
            fileMap[path] = { blobUrl, file };

            if (path.toLowerCase().endsWith('.html')) {
                htmlFiles.push(path);
            }
        }

        if (htmlFiles.length > 0) {
            htmlFiles.sort().forEach(path => {
                const li = document.createElement('li');
                li.innerText = path;
                li.onclick = () => loadHtmlFile(path, li);
                fileListElement.appendChild(li);
            });

            // è‡ªåŠ¨åŠ è½½ï¼šä¼˜å…ˆ index.htmlï¼Œå¦åˆ™åŠ è½½ç¬¬ä¸€ä¸ª
            const target = htmlFiles.find(p => p.toLowerCase().includes('index.html')) || htmlFiles[0];
            loadHtmlFile(target, fileListElement.firstChild);
        } else {
            alert("æœªæ£€æµ‹åˆ° HTML æ–‡ä»¶ï¼");
        }
    }

    async function loadHtmlFile(path, element) {
        document.querySelectorAll('#file-list li').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        
        welcome.classList.add('hidden');
        previewFrame.classList.remove('hidden');
        statusBar.innerText = `å½“å‰è·¯å¾„: ${path}`;

        const { file } = fileMap[path];
        let content = await file.text();

        // è·¯å¾„å…³è”æ ¸å¿ƒé€»è¾‘
        for (const [relPath, data] of Object.entries(fileMap)) {
            const escapedPath = relPath.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(['"])(?:\\.\\/)?${escapedPath}(['"])`, 'g');
            content = content.replace(regex, `$1${data.blobUrl}$2`);
        }

        const doc = previewFrame.contentWindow.document;
        doc.open();
        doc.write(content);
        doc.close();
    }
</script>
</body>
</html>
