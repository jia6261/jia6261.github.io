
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ–‡ä»¶å¤¹éƒ¨ç½²é¢„è§ˆå™¨</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .upload-card { 
            background: white; border: 2px dashed #cbd5e1; border-radius: 12px;
            padding: 40px; text-align: center; transition: all 0.3s;
        }
        .upload-card:hover { border-color: var(--primary); background: #f1f5f9; }
        .btn {
            background: var(--primary); color: white; padding: 10px 20px;
            border-radius: 6px; cursor: pointer; display: inline-block; font-weight: 500;
        }
        #preview-frame {
            width: 100%; height: 600px; border: 1px solid #e2e8f0;
            border-radius: 8px; margin-top: 20px; background: white; display: none;
        }
        .status { margin-top: 10px; font-size: 14px; color: #64748b; }
    </style>
</head>
<body>

<div class="container">
    <div class="upload-card" id="drop-zone">
        <h2>ğŸ“‚ ä¸Šä¼ é¡¹ç›®æ–‡ä»¶å¤¹</h2>
        <p>é€‰æ‹©åŒ…å« index.html çš„æ•´ä¸ªæ–‡ä»¶å¤¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å…³è” CSS/JS/å›¾ç‰‡</p>
        <label class="btn">
            é€‰æ‹©æ–‡ä»¶å¤¹
            <input type="file" id="folder-input" webkitdirectory directory multiple hidden>
        </label>
        <div id="file-status" class="status">æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶</div>
    </div>

    <iframe id="preview-frame"></iframe>
</div>

<script>
    const folderInput = document.getElementById('folder-input');
    const previewFrame = document.getElementById('preview-frame');
    const status = document.getElementById('file-status');

    folderInput.addEventListener('change', async (e) => {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;

        status.innerText = `æ­£åœ¨å¤„ç† ${files.length} ä¸ªæ–‡ä»¶...`;

        // 1. å»ºç«‹è·¯å¾„æ˜ å°„è¡¨ { "style.css": "blob:xxx", "img/logo.png": "blob:yyy" }
        const fileMap = {};
        let entryHtmlFile = null;

        for (const file of files) {
            const path = file.webkitRelativePath.split('/').slice(1).join('/');
            const blobUrl = URL.createObjectURL(file);
            fileMap[path] = blobUrl;

            // å¯»æ‰¾å…¥å£æ–‡ä»¶ (ä¼˜å…ˆæ‰¾ index.html æˆ–æ ¹ç›®å½•ä¸‹çš„ html)
            if (path.toLowerCase() === 'index.html' || (!entryHtmlFile && path.endsWith('.html'))) {
                entryHtmlFile = file;
            }
        }

        if (!entryHtmlFile) {
            alert("æ–‡ä»¶å¤¹å†…æœªæ‰¾åˆ° .html å…¥å£æ–‡ä»¶ï¼");
            return;
        }

        // 2. è¯»å–å¹¶è§£æå…¥å£ HTML
        let htmlContent = await entryHtmlFile.text();

        // 3. æ ¸å¿ƒæ›¿æ¢é€»è¾‘ï¼šå°† HTML ä¸­çš„ç›¸å¯¹è·¯å¾„æ›¿æ¢ä¸º Blob URL
        // å¤„ç† href, src å±æ€§
        for (const [relativePath, blobUrl] of Object.entries(fileMap)) {
            // ç®€å•æ­£åˆ™æ›¿æ¢ï¼šåŒ¹é…å¼•å·å†…çš„ç›¸å¯¹è·¯å¾„ï¼ˆæ³¨æ„ï¼šå¤æ‚è·¯å¾„å¯èƒ½éœ€è¦æ›´ç²¾å¯†çš„æ­£åˆ™æˆ– DOMParserï¼‰
            const escapedPath = relativePath.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(['"])(?:\\.\\/)?${escapedPath}(['"])`, 'g');
            htmlContent = htmlContent.replace(regex, `$1${blobUrl}$2`);
        }

        // 4. å°†å¤„ç†åçš„ HTML åŠ è½½åˆ° iframe
        previewFrame.style.display = 'block';
        const doc = previewFrame.contentWindow.document;
        doc.open();
        doc.write(htmlContent);
        doc.close();

        status.innerText = `æˆåŠŸåŠ è½½ï¼š${entryHtmlFile.name}`;
    });
</script>

</body>
</html>
